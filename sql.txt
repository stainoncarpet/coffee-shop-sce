CREATE TABLE USERS
   (
      ID INT AUTO_INCREMENT PRIMARY KEY, 
      FNAME VARCHAR(20) NOT NULL,
      LNAME VARCHAR(20) NOT NULL,
      EMAIL VARCHAR(40) NOT NULL UNIQUE,
      PASSWORD VARCHAR(44),
	ROLE VARCHAR(10) DEFAULT 'NONE',
	CHECK (ROLE IN ('NONE', 'CLIENT', 'BARISTA', 'ADMIN'))
   );

 CREATE TABLE CLIENTS
   (
	USER_ID INT NOT NULL UNIQUE,
	IS_VIP BOOLEAN DEFAULT(false),
	PRIMARY KEY (USER_ID, IS_VIP),
	FOREIGN KEY (USER_ID) REFERENCES USERS(ID)
   );

   CREATE TABLE BARISTAS
   (
	USER_ID INT NOT NULL UNIQUE,
	AMOUNT_EARNED DOUBLE DEFAULT 0,
	PRIMARY KEY (AMOUNT_EARNED),
	FOREIGN KEY (USER_ID) REFERENCES USERS(ID)
   );

   CREATE TABLE ADMINS
   (
	USER_ID INT NOT NULL UNIQUE,
	FOREIGN KEY (USER_ID) REFERENCES USERS(ID)
   );

   CREATE TABLE CONSUMABLES
   (
      CONSUMABLE_ID INT AUTO_INCREMENT PRIMARY KEY,
      TITLE VARCHAR(60) NOT NULL UNIQUE,
      DESCRIPTION VARCHAR(300) NOT NULL UNIQUE,
      PRICE DOUBLE NOT NULL DEFAULT 0,
	TYPE VARCHAR(10) NOT NULL DEFAULT 'NONE',
	IN_STOCK INT NOT NULL DEFAULT 0,
	CHECK (TYPE IN ('NONE', 'TEA', 'COFFEE', 'SNACK', 'DRINK'))
   );


   CREATE TABLE ORDERS_METADATA
   (
      ORDER_ID INT AUTO_INCREMENT PRIMARY KEY, 
      CLIENT_ID INT NOT NULL,
      CREATION_DATE DATE NOT NULL,
      STATUS VARCHAR(20) NOT NULL,
      ORDER_TOTAL DOUBLE NOT NULL,
	BARISTA_ID INT,
	FOREIGN KEY (CLIENT_ID) REFERENCES USERS(ID),
	FOREIGN KEY (BARISTA_ID) REFERENCES USERS(ID)
   );
   
   CREATE TABLE ORDERS_CONTENTS
   (
      ORDER_ID INT NOT NULL, 
      ITEM_ID INT NOT NULL,
      QUANTITY INT NOT NULL,
	FOREIGN KEY (ORDER_ID) REFERENCES ORDERS_METADATA(ORDER_ID),
	FOREIGN KEY (ITEM_ID) REFERENCES CONSUMABLES(CONSUMABLE_ID)
   );

   CREATE TABLE CONSUMABLE_OTD
   (
	FOR_DATE DATE NOT NULL,
	CONSUMABLE_ID INT NOT NULL,
	PRIMARY KEY (FOR_DATE, CONSUMABLE_ID),
	FOREIGN KEY (CONSUMABLE_ID) REFERENCES CONSUMABLES(CONSUMABLE_ID)
   );


   CREATE TABLE VIP_COFFEES
   (
	ORDER_ID INT NOT NULL,
	QUANTITY INT NOT NULL,
	PRIMARY KEY (ORDER_ID, QUANTITY),
	FOREIGN KEY (ORDER_ID) REFERENCES ORDERS_METADATA(ORDER_ID)
   );

   CREATE TABLE TABLES
   (
	TABLE_ID INT AUTO_INCREMENT PRIMARY KEY,
	SEATS_COUNT INT NOT NULL DEFAULT 0,
	HOURLY_RATE DOUBLE NOT NULL DEFAULT 0,
	LOCATION VARCHAR(10) NOT NULL DEFAULT 'NONE',
	CHECK (LOCATION IN ('NONE', 'INSIDE', 'OUTSIDE'))
   );

   CREATE TABLE RESERVATIONS_METADATA
   (
	RESERVATION_ID INT AUTO_INCREMENT PRIMARY KEY,
	CLIENT_ID INT NOT NULL,
      CREATION_DATE DATE NOT NULL,
	RESERVATION_DATE DATE NOT NULL,
      STATUS VARCHAR(20) NOT NULL DEFAULT 'NONE',
      RESERVATION_TOTAL DOUBLE NOT NULL,
      BARISTA_ID INT,
	CHECK (STATUS IN ('NONE', 'PENDING', 'COMPLETED')),
	FOREIGN KEY (CLIENT_ID) REFERENCES USERS(ID),
	FOREIGN KEY (BARISTA_ID) REFERENCES USERS(ID)
   );

   CREATE TABLE RESERVATIONS_CONTENTS
   (
      RESERVATION_ID INT NOT NULL, 
      TABLE_ID INT NOT NULL,
      START_HOUR INT NOT NULL,
	END_HOUR INT NOT NULL,
	FOREIGN KEY (RESERVATION_ID) REFERENCES RESERVATIONS_METADATA(RESERVATION_ID),
	FOREIGN KEY (TABLE_ID) REFERENCES TABLES(TABLE_ID)
   );

   CREATE TABLE TABLES_OFFDATES
   (
	OFF_DATE DATE NOT NULL,
	TABLE_ID INT NOT NULL,
	PRIMARY KEY (OFF_DATE, TABLE_ID),
	FOREIGN KEY (TABLE_ID) REFERENCES TABLES(TABLE_ID)
   )